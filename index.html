<!DOCTYPE html>
<html>
<head>
    <title>That's My Life - Data Recovery</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f9fafb;
        }
        h1 { color: #1e3a8a; }
        .section {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .data-key {
            font-weight: bold;
            color: #059669;
            margin-bottom: 0.5rem;
        }
        .data-value {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 6px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .empty {
            color: #9ca3af;
            font-style: italic;
        }
        .count {
            color: #059669;
            font-weight: bold;
            font-size: 1.2rem;
        }
        button {
            background: #059669;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
        }
        button:hover {
            background: #047857;
        }
        .danger {
            background: #dc2626;
        }
        .danger:hover {
            background: #b91c1c;
        }
    </style>
</head>
<body>
    <h1>üìä That's My Life - Data Inspector</h1>
    <p style="color: #6b7280; margin-bottom: 2rem;">This tool shows ALL data stored in your browser's localStorage for That's My Life.</p>

    <div id="data-display"></div>

    <div class="section">
        <h3>üîß Actions</h3>
        <button onclick="exportData()">üì• Export All Data (Backup)</button>
        <button onclick="location.reload()">üîÑ Refresh</button>
    </div>

    <script>
        const KEYS = [
            'user',
            'vault_contacts',
            'vault_inheritors',
            'vault_stories',
            'vault_lifebook',
            'vault_photos',
            'spotify_music_data',
            'spotify_token',
            'spotify_refresh_token',
            'spotify_token_expires',
            'spotify_profile',
            'spotify_code_verifier'
        ];

        function displayData() {
            const container = document.getElementById('data-display');
            let html = '';

            // Summary
            html += '<div class="section">';
            html += '<h3>üìà Data Summary</h3>';
            
            const user = localStorage.getItem('user');
            if (user) {
                const userData = JSON.parse(user);
                html += `<p><strong>Logged in as:</strong> ${userData.email}</p>`;
            } else {
                html += `<p class="empty">No user logged in</p>`;
            }

            const contacts = JSON.parse(localStorage.getItem('vault_contacts') || '[]');
            const inheritors = JSON.parse(localStorage.getItem('vault_inheritors') || '[]');
            const stories = Object.keys(JSON.parse(localStorage.getItem('vault_stories') || '{}'));
            const lifebook = Object.keys(JSON.parse(localStorage.getItem('vault_lifebook') || '{}'));
            const music = JSON.parse(localStorage.getItem('spotify_music_data') || '[]');

            html += `<p>üìû <strong>Contacts:</strong> <span class="count">${contacts.length}</span></p>`;
            html += `<p>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ <strong>Inheritors:</strong> <span class="count">${inheritors.length}</span></p>`;
            html += `<p>‚ú® <strong>Stories:</strong> <span class="count">${stories.length}</span></p>`;
            html += `<p>üìñ <strong>Life Book Chapters:</strong> <span class="count">${lifebook.length}</span></p>`;
            html += `<p>üéµ <strong>Songs:</strong> <span class="count">${music.length}</span></p>`;
            html += '</div>';

            // Detailed data
            KEYS.forEach(key => {
                const value = localStorage.getItem(key);
                
                html += '<div class="section">';
                html += `<div class="data-key">${key}</div>`;
                
                if (value) {
                    try {
                        // Try to parse and pretty-print JSON
                        const parsed = JSON.parse(value);
                        html += `<div class="data-value">${JSON.stringify(parsed, null, 2)}</div>`;
                    } catch {
                        // Not JSON, display as-is
                        html += `<div class="data-value">${value}</div>`;
                    }
                } else {
                    html += '<div class="data-value empty">No data stored</div>';
                }
                
                html += '</div>';
            });

            container.innerHTML = html;
        }

        function exportData() {
            const allData = {};
            KEYS.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        allData[key] = JSON.parse(value);
                    } catch {
                        allData[key] = value;
                    }
                }
            });

            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `thatsmylife-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('‚úÖ Data exported! Save this file as a backup.');
        }

        // Display data on load
        displayData();
    </script>
</body>
</html>
